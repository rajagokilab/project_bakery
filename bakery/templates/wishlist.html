{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container my-5">
    <h2 class="text-center fw-bold mb-4">My Wishlist</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for item in wishlist_items %}
        <div class="col">
            <div class="card border-0 shadow-sm rounded-4 position-relative h-100">

                <!-- Wishlist Heart -->
                <!-- <button class="btn btn-light position-absolute top-0 end-0 m-2 rounded-circle shadow-sm wishlist-btn" 
                        data-id="{{ item.product.slug }}">
                    <i class="bi bi-heart-fill text-danger fs-5"></i>
                </button> -->

                <!-- Product Image -->
                <a href="{% url 'product_detail' item.product.slug %}">
                    <img src="{{ item.product.image }}" class="card-img-top rounded-top-4" 
                         alt="{{ item.product.name }}" style="height:280px; object-fit:cover;">
                </a>

                <!-- Product Info Overlay -->
                <div class="card-body text-center bg-warning bg-opacity-25 rounded-bottom-4 py-3">
                    <h5 class="fw-bold text-uppercase mb-1">{{ item.product.name }}</h5>
                    <p class="mb-0">₹ {{ item.product.price }}</p>
                    <a href="{% url 'remove_from_wishlist' item.product.slug %}" class="btn btn-danger btn-sm mt-2">
                        Remove
                    </a>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-center">Your wishlist is empty ❤️</p>
        {% endfor %}
    </div>
</div>

<!-- Wishlist JS -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const buttons = document.querySelectorAll(".wishlist-btn");

  buttons.forEach(btn => {
    btn.addEventListener("click", function () {
      const icon = this.querySelector("i");
      const productSlug = this.dataset.id;

      // Toggle heart icon
      icon.classList.toggle("bi-heart");
      icon.classList.toggle("bi-heart-fill");
      icon.classList.toggle("text-danger");

      // AJAX request to remove from wishlist
      fetch(`/wishlist/toggle/${productSlug}/`, {
        method: "POST",
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({})
      })
      .then(res => res.json())
      .then(data => {
        console.log("Wishlist updated:", data);
        if(data.status === "removed") {
            btn.closest(".col").remove(); // remove card from wishlist view
        }
      });
    });
  });
});
</script>

{% endblock %}
